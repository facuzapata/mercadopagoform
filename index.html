<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Demo Mercado Pago PRO (solo frontend)</title>
    <script src="https://sdk.mercadopago.com/js/v2"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 720px;
            margin: 32px auto;
            padding: 0 16px;
        }

        label {
            display: block;
            margin-top: 10px;
            font-weight: 600;
        }

        input,
        select,
        button {
            width: 100%;
            padding: 8px;
            margin-top: 6px;
            box-sizing: border-box;
        }

        .row {
            display: flex;
            gap: 10px;
        }

        .row>* {
            flex: 1;
        }

        pre {
            background: #f6f8fa;
            padding: 10px;
            border-radius: 6px;
            overflow: auto;
        }
    </style>
</head>

<body>

    <h1>Demo PRO: token + cuotas (simulado)</h1>

    <form id="mp-form">
        <label>Email
            <input id="email" type="email" value="APP_USR-03f91d11-09d8-4c9f-938e-88e3cd357cf1" required>
        </label>

        <label>Número de tarjeta
            <input id="cardNumber" placeholder="4509 9535 6623 3704" required>
        </label>

        <div class="row">
            <div><label>Mes<input id="cardExpirationMonth" placeholder="12" required></label></div>
            <div><label>Año<input id="cardExpirationYear" placeholder="2028" required></label></div>
        </div>

        <div class="row">
            <div><label>CVV<input id="securityCode" placeholder="123" required></label></div>
            <div><label>Titular<input id="cardholderName" placeholder="Nombre Apellido" required></label></div>
        </div>

        <label>Documento
            <div class="row">
                <select id="docType">
                    <option value="DNI">DNI</option>
                </select>
                <input id="docNumber" placeholder="19119119">
            </div>
        </label>

        <label>Método de pago detectado
            <input id="paymentMethod" readonly>
        </label>

        <label>Cuotas
            <select id="installments" required>
                <option value="">Seleccionar...</option>
            </select>
        </label>

        <button type="submit">Generar datos</button>
    </form>

    <h3>Resultado</h3>
    <pre id="result">Esperando acción...</pre>

    <script>
        const PUBLIC_KEY = "TEST-0bea6f5a-327d-4e6d-a4ad-cb020866f515";
        const mp = new MercadoPago(PUBLIC_KEY, { locale: "es-AR" });

        const cardNumberInput = document.getElementById("cardNumber");
        const installmentsSelect = document.getElementById("installments");
        const paymentMethodInput = document.getElementById("paymentMethod");

        let paymentMethodId = null;

        // Simulación de detección de método y cuotas
        cardNumberInput.addEventListener("keyup", (e) => {
            const cardNumber = e.target.value.replace(/\s/g, '');
            if (cardNumber.length >= 6) {
                const bin = cardNumber.substring(0, 6);
                // Demo: método de pago simulado según BIN
                paymentMethodId = bin.startsWith("4509") ? "visa" : "master";
                paymentMethodInput.value = paymentMethodId;

                // Demo: cuotas simuladas
                const mockInstallments = [
                    { installments: 1, recommended_message: "1 cuota de $1000" },
                    { installments: 3, recommended_message: "3 cuotas de $350 c/u" },
                    { installments: 6, recommended_message: "6 cuotas de $180 c/u" }
                ];
                installmentsSelect.innerHTML = mockInstallments.map(c =>
                    `<option value="${c.installments}">${c.recommended_message}</option>`
                ).join('');
            }
        });

        // Crear token y mostrar JSON final
        document.getElementById("mp-form").addEventListener("submit", async (e) => {
            e.preventDefault();
            const resultEl = document.getElementById("result");

            try {
                const cardData = {
                    card_number: cardNumberInput.value.replace(/\s/g, ""),
                    expiration_month: document.getElementById("cardExpirationMonth").value,
                    expiration_year: document.getElementById("cardExpirationYear").value,
                    security_code: document.getElementById("securityCode").value,
                    cardholder: {
                        name: document.getElementById("cardholderName").value,
                        identification: {
                            type: document.getElementById("docType").value,
                            number: document.getElementById("docNumber").value
                        }
                    }
                };

                const tokenRes = await mp.createCardToken(cardData);
                const finalData = {
                    userId: 9,
                    courseId: "zwx9hi2a111ow1o0pc8oggoo",
                    mercadoPagoTokenId: tokenRes.id,
                    installments: parseInt(installmentsSelect.value || 1),
                    paymentMethodId
                };

                resultEl.textContent = JSON.stringify(finalData, null, 2);

            } catch (err) {
                console.error(err);
                resultEl.textContent = "Error: " + (err.message || JSON.stringify(err));
            }
        });
    </script>

</body>

</html>